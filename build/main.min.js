!function(){var e=function(e){this.blockSize=e.blockSize||25,this.rows=e.rows||10,this.cols=e.cols||18,this.terisNode=document.getElementById(e.id),this._init()};e.prototype={blockSize:0,terisNode:null,rows:0,cols:0,canvas:null,canvasW:10*this.blockSize,canvasH:20*this.blockSize,infoCanvas:null,speedDownFlag:!1,starVoiceFlag:!0,moveAudio:null,bgAudio:null,clearAudio1:null,clearAudio2:null,clearAudio3:null,clearAudio4:null,speedDown:null,clickAudio:null,gameOver:null,fight:null,imgBlue:null,imgPink:null,imgGreen:null,imgPurple:null,imgRed:null,imgYellow:null,imgLightBlue:null,imgGameOver:null,imgGameIntroduction:null,drawCanvasBlockFlag:!0,showGameOverFlag:!1,point:0,hasRows:0,level:1,speedTime:1e3,activeBlock:null,time:null,useTimeFlag:null,starFlag:!1,toTopFlag:!0,shapeArr:["S","Z","L","J","I","O","T"],dirArr:["up","right","down","left"],blockData:null,cacheBlock:null,cacheBlockData:{S:{up:{xy:[{x:0,y:2},{x:1,y:1},{x:1,y:2},{x:2,y:1}],dir:"up",nextDir:"right",shape:"S",color:"purple",value:1},right:{xy:[{x:1,y:0},{x:1,y:1},{x:2,y:1},{x:2,y:2}],dir:"right",nextDir:"down",shape:"S",color:"purple",value:1},down:{xy:[{x:0,y:2},{x:1,y:1},{x:1,y:2},{x:2,y:1}],dir:"down",nextDir:"left",shape:"S",color:"purple",value:1},left:{xy:[{x:1,y:0},{x:1,y:1},{x:2,y:1},{x:2,y:2}],dir:"left",nextDir:"up",shape:"S",color:"purple",value:1}},Z:{up:{xy:[{x:0,y:1},{x:1,y:1},{x:1,y:2},{x:2,y:2}],dir:"up",nextDir:"right",shape:"Z",color:"green",value:2},right:{xy:[{x:2,y:0},{x:2,y:1},{x:1,y:1},{x:1,y:2}],dir:"right",nextDir:"down",shape:"Z",color:"green",value:2},down:{xy:[{x:0,y:1},{x:1,y:1},{x:1,y:2},{x:2,y:2}],dir:"down",nextDir:"left",shape:"Z",color:"green",value:2},left:{xy:[{x:2,y:0},{x:2,y:1},{x:1,y:1},{x:1,y:2}],dir:"left",nextDir:"up",shape:"Z",color:"green",value:2}},L:{up:{xy:[{x:1,y:1},{x:1,y:2},{x:1,y:3},{x:2,y:3}],dir:"up",nextDir:"right",shape:"L",color:"blue",value:3},right:{xy:[{x:1,y:1},{x:1,y:2},{x:2,y:1},{x:3,y:1}],dir:"right",nextDir:"down",shape:"L",color:"blue",value:3},down:{xy:[{x:1,y:1},{x:2,y:1},{x:2,y:2},{x:2,y:3}],dir:"down",nextDir:"left",shape:"L",color:"blue",value:3},left:{xy:[{x:2,y:1},{x:2,y:2},{x:1,y:2},{x:0,y:2}],dir:"left",nextDir:"up",shape:"L",color:"blue",value:3}},J:{up:{xy:[{x:2,y:1},{x:2,y:2},{x:2,y:3},{x:1,y:3}],dir:"up",nextDir:"right",shape:"J",color:"pink",value:4},right:{xy:[{x:1,y:1},{x:1,y:2},{x:2,y:2},{x:3,y:2}],dir:"right",nextDir:"down",shape:"J",color:"pink",value:4},down:{xy:[{x:1,y:1},{x:1,y:2},{x:1,y:3},{x:2,y:1}],dir:"down",nextDir:"left",shape:"J",color:"pink",value:4},left:{xy:[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:2,y:2}],dir:"left",nextDir:"up",shape:"J",color:"pink",value:4}},T:{up:{xy:[{x:1,y:1},{x:1,y:2},{x:1,y:3},{x:2,y:2}],dir:"up",nextDir:"right",shape:"T",color:"lightBlue",value:5},right:{xy:[{x:0,y:1},{x:1,y:1},{x:1,y:2},{x:2,y:1}],dir:"right",nextDir:"down",shape:"T",color:"lightBlue",value:5},down:{xy:[{x:1,y:2},{x:2,y:1},{x:2,y:2},{x:2,y:3}],dir:"down",nextDir:"left",shape:"T",color:"lightBlue",value:5},left:{xy:[{x:1,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}],dir:"left",nextDir:"up",shape:"T",color:"lightBlue",value:5}},O:{up:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"up",nextDir:"right",shape:"O",color:"yellow",value:6},right:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"right",nextDir:"down",shape:"O",color:"yellow",value:6},down:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"down",nextDir:"left",shape:"O",color:"yellow",value:6},left:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"left",nextDir:"up",shape:"O",color:"yellow",value:6}},I:{up:{xy:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:1,y:3}],dir:"up",nextDir:"right",shape:"I",color:"red",value:7},right:{xy:[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1}],dir:"right",nextDir:"down",shape:"I",color:"red",value:7},down:{xy:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:1,y:3}],dir:"down",nextDir:"left",shape:"I",color:"red",value:7},left:{xy:[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1}],dir:"left",nextDir:"up",shape:"I",color:"red",value:7}}},dataArr1:[[2,2,2,2,0,0,0,0,0,0],[2,2,2,2,0,0,0,0,0,0],[2,2,2,2,0,0,0,0,0,0],[2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],firstDataArr:[0,0,0,0,0,0,0,0,0,0],dataArr:[],deepCopy:function(e,a){a=a||{};for(var l in e)"object"==typeof e[l]?(a[l]=e[l].constructor===Array?[]:{},this.deepCopy(e[l],a[l])):a[l]=e[l];return a},buildBlockData:function(){var e=this.rows,a=e%2==0?e/2-1:(e-1)/2;this.blockData={S:{up:{xy:[{x:a,y:0},{x:a-1,y:0},{x:a,y:-1},{x:a+1,y:-1}],dir:"up",nextDir:"right",shape:"S",color:"purple",value:1},right:{xy:[{x:a,y:-1},{x:a,y:-2},{x:a+1,y:-1},{x:a+1,y:0}],dir:"right",nextDir:"down",shape:"S",color:"purple",value:1},down:{xy:[{x:a,y:0},{x:a-1,y:0},{x:a,y:-1},{x:a+1,y:-1}],dir:"down",nextDir:"left",shape:"S",color:"purple",value:1},left:{xy:[{x:a,y:-1},{x:a,y:-2},{x:a+1,y:-1},{x:a+1,y:0}],dir:"left",nextDir:"up",shape:"S",color:"purple",value:1}},Z:{up:{xy:[{x:a-1,y:-1},{x:a,y:-1},{x:a,y:0},{x:a+1,y:0}],dir:"up",nextDir:"right",shape:"Z",color:"green",value:2},right:{xy:[{x:a+1,y:-2},{x:a+1,y:-1},{x:a,y:-1},{x:a,y:0}],dir:"right",nextDir:"down",shape:"Z",color:"green",value:2},down:{xy:[{x:a-1,y:-1},{x:a,y:-1},{x:a,y:0},{x:a+1,y:0}],dir:"down",nextDir:"left",shape:"Z",color:"green",value:2},left:{xy:[{x:a+1,y:-2},{x:a+1,y:-1},{x:a,y:-1},{x:a,y:0}],dir:"left",nextDir:"up",shape:"Z",color:"green",value:2}},L:{up:{xy:[{x:a,y:-2},{x:a,y:-1},{x:a,y:0},{x:a+1,y:0}],dir:"up",nextDir:"right",shape:"L",color:"blue",value:3},right:{xy:[{x:a-1,y:0},{x:a-1,y:-1},{x:a,y:-1},{x:a+1,y:-1}],dir:"right",nextDir:"down",shape:"L",color:"blue",value:3},down:{xy:[{x:a,y:-2},{x:a+1,y:-2},{x:a+1,y:-1},{x:a+1,y:0}],dir:"down",nextDir:"left",shape:"L",color:"blue",value:3},left:{xy:[{x:a-1,y:0},{x:a,y:0},{x:a+1,y:-1},{x:a+1,y:0}],dir:"left",nextDir:"up",shape:"L",color:"blue",value:3}},J:{up:{xy:[{x:a+1,y:-2},{x:a+1,y:-1},{x:a+1,y:0},{x:a,y:0}],dir:"up",nextDir:"right",shape:"J",color:"pink",value:4},right:{xy:[{x:a,y:-1},{x:a,y:0},{x:a+1,y:0},{x:a+2,y:0}],dir:"right",nextDir:"down",shape:"J",color:"pink",value:4},down:{xy:[{x:a,y:-2},{x:a+1,y:-2},{x:a,y:-1},{x:a,y:0}],dir:"down",nextDir:"left",shape:"J",color:"pink",value:4},left:{xy:[{x:a-1,y:-1},{x:a,y:-1},{x:a+1,y:-1},{x:a+1,y:0}],dir:"left",nextDir:"up",shape:"J",color:"pink",value:4}},T:{up:{xy:[{x:a,y:-2},{x:a,y:-1},{x:a,y:0},{x:a+1,y:-1}],dir:"up",nextDir:"right",shape:"T",color:"lightBlue",value:5},right:{xy:[{x:a-1,y:-1},{x:a,y:-1},{x:a+1,y:-1},{x:a,y:0}],dir:"right",nextDir:"down",shape:"T",color:"lightBlue",value:5},down:{xy:[{x:a+1,y:-2},{x:a+1,y:-1},{x:a,y:-1},{x:a+1,y:0}],dir:"down",nextDir:"left",shape:"T",color:"lightBlue",value:5},left:{xy:[{x:a,y:-1},{x:a,y:0},{x:a-1,y:0},{x:a+1,y:0}],dir:"left",nextDir:"up",shape:"T",color:"lightBlue",value:5}},O:{up:{xy:[{x:a,y:-1},{x:a,y:0},{x:a+1,y:-1},{x:a+1,y:0}],dir:"up",nextDir:"right",shape:"O",color:"yellow",value:6},right:{xy:[{x:a,y:-1},{x:a,y:0},{x:a+1,y:-1},{x:a+1,y:0}],dir:"right",nextDir:"down",shape:"O",color:"yellow",value:6},down:{xy:[{x:a,y:-1},{x:a,y:0},{x:a+1,y:-1},{x:a+1,y:0}],dir:"down",nextDir:"left",shape:"O",color:"yellow",value:6},left:{xy:[{x:a,y:-1},{x:a,y:0},{x:a+1,y:-1},{x:a+1,y:0}],dir:"left",nextDir:"up",shape:"O",color:"yellow",value:6}},I:{up:{xy:[{x:a,y:-3},{x:a,y:-2},{x:a,y:-1},{x:a,y:0}],dir:"up",nextDir:"right",shape:"I",color:"red",value:7},right:{xy:[{x:a-1,y:0},{x:a,y:0},{x:a+1,y:0},{x:a+2,y:0}],dir:"right",nextDir:"down",shape:"I",color:"red",value:7},down:{xy:[{x:a,y:-3},{x:a,y:-2},{x:a,y:-1},{x:a,y:0}],dir:"down",nextDir:"left",shape:"I",color:"red",value:7},left:{xy:[{x:a-1,y:0},{x:a,y:0},{x:a+1,y:0},{x:a+2,y:0}],dir:"left",nextDir:"up",shape:"I",color:"red",value:7}}}},buildDataArr:function(){for(var e=this,a=new Array,l=0;l<e.cols;l++){for(var r=new Array,i=0;i<e.rows;i++)r[i]=0;a.push(r)}e.dataArr=a},drawCacheBlock:function(){var i=this;i.infoCanvas.ctx.clearRect(0,0,4*i.blockSize,4*i.blockSize),i.infoCanvas.ctx.fillStyle="#295159",i.infoCanvas.ctx.fillRect(0,0,4*i.blockSize,4*i.blockSize),i.infoCanvas.ctx.stroke();var o,t=i.cacheBlockData[i.cacheBlock.shape][i.cacheBlock.dir];switch(t.color){case"blue":o=i.imgBlue;break;case"pink":o=i.imgPink;break;case"red":o=i.imgRed;break;case"green":o=i.imgGreen;break;case"purple":o=i.imgPurple;break;case"yellow":o=i.imgYellow;break;case"lightBlue":o=i.imgLightBlue}function e(){for(var e=0,a=t.xy.length;e<a;e++){var l=t.xy[e].x*i.blockSize,r=t.xy[e].y*i.blockSize;i.infoCanvas.ctx.fillStyle="rgba(0,0,0,0.3)",i.infoCanvas.ctx.fillRect(l,r,i.blockSize,i.blockSize),i.infoCanvas.ctx.drawImage(o,l,r,i.blockSize,i.blockSize)}}null===i.activeBlock?o.onload=function(){e()}:e()},buildRandBlock:function(){var e=this,a=Math.floor(7*Math.random()),l=Math.floor(4*Math.random()),r=e.shapeArr[a],i=e.dirArr[l];return e.deepCopy(e.blockData[r][i])},builBlockXY:function(){var e=this;null===e.cacheBlock||(e.activeBlock=e.deepCopy(e.cacheBlock)),e.cacheBlock=e.buildRandBlock(),e.drawCacheBlock()},updateDataArr:function(){for(var e=this,a=0,l=0,r=e.activeBlock.xy,i=e.activeBlock.value,o=0,t=r.length;o<t;o++){var n=r[o].y,c=r[o].x;e.dataArr[n]&&(e.dataArr[n][c]=i)}for(var s=0,x=r.length;s<x;s++)0<=r[s].y&&e.dataArr[r[s].y].join().indexOf("0")<0&&(e.dataArr.splice(r[s].y,1),e.dataArr.unshift([0,0,0,0,0,0,0,0,0,0]),a++);if(0<a){switch(a){case 1:l=40*e.level,e.starVoiceFlag&&(e.clearAudio1.currentTime=0,e.clearAudio1.play());break;case 2:l=100*e.level,e.starVoiceFlag&&(e.clearAudio2.currentTime=0,e.clearAudio2.play());break;case 3:l=300*e.level,e.starVoiceFlag&&(e.clearAudio3.currentTime=0,e.clearAudio3.play());break;case 4:l=1200*e.level,e.starVoiceFlag&&(e.clearAudio4.currentTime=0,e.clearAudio4.play())}e.point+=l,document.getElementById("point").innerHTML=e.point,e.hasRows+=a;var d=Math.ceil(e.hasRows/30);30<e.hasRows&&e.level<d&&(e.level=d,document.getElementById("level").innerHTML="等级 "+e.level,clearInterval(e.time),e.speedTime=e.speedTime/e.level,e.loopDown())}},changeBlockXY:function(){for(var e=this,a=!0,l=e.activeBlock.xy,r=0,i=l.length;r<i;r++){if(l[r].y+1>=e.cols){e.speedDownFlag&&e.starVoiceFlag&&(e.speedDown.currentTime=0,e.speedDown.play()),e.updateDataArr(),e.builBlockXY(),a=!1;break}var o=l[r].y+1,t=l[r].x;if(e.dataArr[o]&&1<=e.dataArr[o][t]){e.speedDownFlag&&e.starVoiceFlag&&(e.speedDown.currentTime=0,e.speedDown.play()),e.updateDataArr(),e.builBlockXY();for(var n=0,c=e.activeBlock.xy.length;n<c;n++){if(0<=e.activeBlock.xy[n].y&&1<=e.dataArr[0][e.activeBlock.xy[n].x]){e.drawCanvasBlockFlag=!1,e.toTopFlag=!1,e.showGameOverFlag=!0,console.log("游戏结束"),e.starVoiceFlag&&(e.gameOver.currentTime=0,e.gameOver.play());break}e.showGameOverFlag=!1}a=!1;break}}a&&(l[0].y+=1,l[1].y+=1,l[2].y+=1,l[3].y+=1)},drawSmBlockCanvas:function(e,a,l,r,i){var o,t=this;switch(t.canvas.ctx.fillStyle="rgba(0,0,0,0.3)",t.canvas.ctx.fillRect(e,a,l,r),i){case"blue":o=t.imgBlue;break;case"pink":o=t.imgPink;break;case"red":o=t.imgRed;break;case"green":o=t.imgGreen;break;case"purple":o=t.imgPurple;break;case"yellow":o=t.imgYellow;break;case"lightBlue":o=t.imgLightBlue}t.canvas.ctx.drawImage(o,e,a,this.blockSize,this.blockSize)},drawBlockCanvas:function(){for(var e=this,a=e.activeBlock.xy,l=0,r=a.length;l<r;l++){var i=a[l].x*e.blockSize,o=a[l].y*e.blockSize;e.drawSmBlockCanvas(i,o,e.blockSize,e.blockSize,e.activeBlock.color)}},changeLeftRightBlockXY:function(e){var a=this,l=a.activeBlock.xy;if("right"===e){for(var r=!0,i=0,o=l.length;i<o;i++)a.dataArr[l[i].y]&&1<=a.dataArr[l[i].y][l[i].x+1]&&(r=!1),l[i].x+1>a.rows-1&&(r=!1);if(r){a.clearCanvas(),a.drawBase();for(i=0,o=l.length;i<o;i++){l[i].x+=1;var t=l[i].x*a.blockSize,n=l[i].y*a.blockSize;a.drawSmBlockCanvas(t,n,a.blockSize,a.blockSize,a.activeBlock.color)}a.drawDataArrCanvas()}}else if("left"===e){var c=!0;for(i=0,o=l.length;i<o;i++)a.dataArr[l[i].y]&&1<=a.dataArr[l[i].y][l[i].x-1]&&(c=!1),l[i].x-1<0&&(c=!1);if(c){a.clearCanvas(),a.drawBase();for(i=0,o=l.length;i<o;i++){l[i].x-=1;t=l[i].x*a.blockSize,n=l[i].y*a.blockSize;a.drawSmBlockCanvas(t,n,a.blockSize,a.blockSize,a.activeBlock.color)}a.drawDataArrCanvas()}}},rotate:function(){var e=this;if("O"!==e.activeBlock.shape){for(var a=!0,l=e.activeBlock,r=l.xy,i=e.blockData[l.shape][l.dir].xy,o=r[0].y-i[0].y,t=r[0].x-i[0].x,n=e.deepCopy(e.blockData[l.shape][l.nextDir]),c=n.xy,s=0,x=c.length;s<x;s++){c[s].x+=t,c[s].y+=o;var d=c[s].y,y=c[s].x;if(y>=e.rows||y<0||e.dataArr[d]&&1<=e.dataArr[d][y]){a=!1;break}}a&&(e.activeBlock=n,e.clearCanvas(),e.drawBase(),e.drawDataArrCanvas(),e.drawCanvasBlockFlag&&e.drawBlockCanvas())}},buildUseTime:function(){var e=this,a=0,l=0,r=0,i="00",o="00",t="00";e.useTimeFlag=setInterval(function(){e.toTopFlag&&e.starFlag&&(r<59?t=++r<10?"0"+r:r:(t=(r=0)<10?"0"+r:r,l<59?o=++l<10?"0"+l:l:(o=(l=0)<10?"0"+l:l,i=++a<10?"0"+a:a)),document.getElementById("useTime").innerHTML=i+":"+o+":"+t)},1e3)},bindEvent:function(){var l=this,e=(document.getElementById("moveVoice"),document.getElementById("startVoice"));function a(){/stopVoice/.test(e.src)&&(l.moveAudio.currentTime=0,l.moveAudio.play())}function r(){l.clickAudio.currentTime=0,l.clickAudio.play()}document.addEventListener("keydown",function(e){"38"!=e.keyCode&&"87"!=e.keyCode||l.starFlag&&l.toTopFlag&&(a(),l.rotate()),"40"!=e.keyCode&&"83"!=e.keyCode||l.starFlag&&l.toTopFlag&&(l.speedDownFlag=!0,a(),l.clearCanvas(),l.drawBase(),l.changeBlockXY(),l.drawDataArrCanvas(),l.drawCanvasBlockFlag&&l.drawBlockCanvas(),l.showGameOver()),"37"!=e.keyCode&&"65"!=e.keyCode||l.starFlag&&l.toTopFlag&&(a(),l.changeLeftRightBlockXY("left")),"39"!=e.keyCode&&"68"!=e.keyCode||l.starFlag&&l.toTopFlag&&(a(),l.changeLeftRightBlockXY("right")),"32"==e.keyCode&&(a(),console.log("瞬间坠落"))}),document.addEventListener("keyup",function(e){"40"!=e.keyCode&&"83"!=e.keyCode||l.starFlag&&l.toTopFlag&&(l.speedDownFlag=!1)}),document.getElementById("startGame").addEventListener("click",function(){if(r(),/startGame/.test(this.src)){if(l.starVoiceFlag&&(l.fight.currentTime=0,l.fight.play()),null===l.activeBlock){l.bgAudio.play();var e=0,a=setInterval(function(){l.clearCanvas(),l.drawBase(),l.canvas.ctx.drawImage(l.imgGameIntroduction,0,e,l.canvasW,l.canvasH),(e+=5)===l.canvasH+5&&clearInterval(a)},5)}!0===l.toTopFlag&&(l.starFlag=!0,this.src="./images/stopGame.png",null===l.activeBlock&&(l.activeBlock=l.deepCopy(l.cacheBlock),l.cacheBlock=l.buildRandBlock(),l.drawCacheBlock())),l.useTimeFlag||l.buildUseTime(),l.time||l.loopDown()}else!0===l.toTopFlag&&(l.starFlag=!1,this.src="./images/startGame.png")}),document.getElementById("reStart").addEventListener("click",function(){l.starVoiceFlag&&(l.fight.currentTime=0,l.fight.play()),r();var e=document.getElementById("startGame");if(/startGame/.test(e.src)){if(null===l.activeBlock)return!1;e.src="./images/stopGame.png"}l.useTimeFlag&&(clearInterval(l.useTimeFlag),document.getElementById("useTime").innerHTML="00:00:00",l.buildUseTime()),l.point=0,document.getElementById("point").innerHTML=l.point,l.hasRows=0,l.level=1,document.getElementById("level").innerHTML="等级 "+l.level,l.drawCanvasBlockFlag=!0,l.starFlag=!0,l.toTopFlag=!0,l.showGameOverFlag=!1,l.speedTime=1e3,l.time&&(clearTimeout(l.time),l.clearCanvas(),l.drawBase(),l.builBlockXY(),l.buildDataArr(),l.loopDown())}),document.getElementById("startVoice").addEventListener("click",function(){r(),/stopVoice/.test(this.src)?(this.src="./images/startVoice.png",l.bgAudio.pause(),l.starVoiceFlag=!1):(this.src="./images/stopVoice.png",l.bgAudio.play(),l.starVoiceFlag=!0)})},drawDataArrCanvas:function(){for(var e=this,a=0,l=e.dataArr.length;a<l;a++)for(var r=e.dataArr[a],i=0,o=r.length;i<o;i++)if(1<=r[i]){var t="";switch(r[i]){case 1:t="purple";break;case 2:t="green";break;case 3:t="blue";break;case 4:t="pink";break;case 5:t="lightBlue";break;case 6:t="yellow";break;case 7:t="red"}var n=i*e.blockSize,c=a*e.blockSize;e.drawSmBlockCanvas(n,c,e.blockSize,e.blockSize,t)}},clearCanvas:function(){this.canvas.ctx.clearRect(0,0,this.canvasW,this.canvasH)},buildBase:function(){var e=this;e.canvasW=e.blockSize*e.rows,e.canvasH=e.blockSize*e.cols,e.canvas=document.createElement("canvas"),e.canvas.width=e.canvasW,e.canvas.height=e.canvasH,e.terisNode.appendChild(e.canvas),e.infoCanvas=document.createElement("canvas"),e.infoCanvas.width=4*e.blockSize,e.infoCanvas.height=4*e.blockSize;var i=document.createElement("div");i.id="divInfo",i.appendChild(e.infoCanvas),e.terisNode.appendChild(i);var a=document.createElement("div");a.id="useTime",a.appendChild(document.createTextNode("00:00:00")),i.appendChild(a);var l=document.createElement("div");l.id="level",l.appendChild(document.createTextNode("等级 1")),i.appendChild(l);var r=document.createElement("div"),o=document.createElement("div");function t(e){var a=new Audio;return a.src="./voice/"+e+".mp3",a.preload=!0,a}function n(e,a){var l=document.createElement("img"),r=a||e;l.src="./images/"+r+".png",l.id=e,i.appendChild(l)}r.id="pointTitle",o.id="point",r.appendChild(document.createTextNode("得分")),o.appendChild(document.createTextNode("0")),r.appendChild(o),i.appendChild(r),e.moveAudio=t("pop"),e.clearAudio1=t("good"),e.clearAudio2=t("great"),e.clearAudio3=t("excellent"),e.clearAudio4=t("amazing"),e.speedDown=t("clearBg"),e.clickAudio=t("click"),e.fight=t("fight"),e.gameOver=t("gameOver"),e.bgAudio=t("bgMusic"),e.bgAudio.loop=!0,e.bgAudio.volume=.8,n("startGame"),n("reStart"),n("startVoice","stopVoice"),e.infoCanvas.ctx=e.infoCanvas.getContext("2d"),e.infoCanvas.ctx.beginPath(),e.infoCanvas.ctx.fillStyle="#295159",e.infoCanvas.ctx.fillRect(0,0,4*e.blockSize,4*e.blockSize);for(var c=1;c<4;c++)e.infoCanvas.ctx.moveTo(e.blockSize*c,0),e.infoCanvas.ctx.lineTo(e.blockSize*c,4*e.blockSize),e.infoCanvas.ctx.lineWidth=1;for(c=1;c<4;c++)e.infoCanvas.ctx.moveTo(0,e.blockSize*c),e.infoCanvas.ctx.lineTo(4*e.blockSize,e.blockSize*c),e.infoCanvas.ctx.lineWidth=1;e.infoCanvas.ctx.strokeStyle="#B8895F",e.infoCanvas.ctx.stroke(),e.canvas.ctx=e.canvas.getContext("2d"),e.canvas.ctx.beginPath();for(c=1;c<e.rows;c++)e.canvas.ctx.moveTo(e.blockSize*c,0),e.canvas.ctx.lineTo(e.blockSize*c,e.canvasH),e.canvas.ctx.lineWidth=1;for(c=1;c<e.cols;c++)e.canvas.ctx.moveTo(0,e.blockSize*c),e.canvas.ctx.lineTo(e.canvasW,e.blockSize*c),e.canvas.ctx.lineWidth=1;e.canvas.ctx.strokeStyle="#B8895F",e.drawBase()},drawBase:function(){this.canvas.ctx.stroke()},showGameOver:function(){var e=this,a=e.canvasH;if(e.showGameOverFlag){e.canvas.ctx.fillStyle="rgba(0,0,0,0.3)";var l=setInterval(function(){e.clearCanvas(),e.drawBase(),e.drawDataArrCanvas(),e.canvas.ctx.fillRect(0,a,e.canvasW,e.canvasH),-10===(a-=10)&&(clearInterval(l),e.canvas.ctx.drawImage(e.imgGameOver,25,125,200,128))},10)}},drawIntroduction:function(){var e=this;e.imgGameIntroduction.onload=function(){console.log(this.width),e.canvas.ctx.drawImage(e.imgGameIntroduction,0,0,this.width,this.height)}},loopDown:function(){var e=this;e.time=setInterval(function(){e.starFlag&&e.toTopFlag&&(e.clearCanvas(),e.drawBase(),e.drawCanvasBlockFlag&&e.drawBlockCanvas(),e.changeBlockXY(),e.drawDataArrCanvas(),e.showGameOver()),console.log(e.time)},e.speedTime)},preImg:function(){var e=this;e.imgBlue=new Image,e.imgBlue.src="./images/blueBlcok.png",e.imgPink=new Image,e.imgPink.src="./images/pinkBlcok.png",e.imgGreen=new Image,e.imgGreen.src="./images/greenBlcok.png",e.imgRed=new Image,e.imgRed.src="./images/redBlcok.png",e.imgPurple=new Image,e.imgPurple.src="./images/purpleBlcok.png",e.imgYellow=new Image,e.imgYellow.src="./images/yellowBlcok.png",e.imgLightBlue=new Image,e.imgLightBlue.src="./images/lightBlueBlcok.png",e.imgGameOver=new Image,e.imgGameOver.src="./images/gameOver.png",e.imgGameIntroduction=new Image,e.imgGameIntroduction.src="./images/gameIntroduction.jpg"},_init:function(){var e=this;e.preImg(),e.buildBlockData(),e.buildDataArr(),e.buildBase(),e.builBlockXY(),e.bindEvent(),e.drawIntroduction()}},window.Tetris=e}();