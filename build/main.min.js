+function(){var e=function(e){this.blockSize=e.blockSize||25,this.rows=e.rows||10,this.cols=e.cols||18,this.terisNode=document.getElementById(e.id),this._init()};e.prototype={blockSize:0,terisNode:null,rows:0,cols:0,canvas:null,canvasW:10*this.blockSize,canvasH:20*this.blockSize,infoCanvas:null,speedDownFlag:!1,starVoiceFlag:!0,moveAudio:null,bgAudio:null,clearAudio1:null,clearAudio2:null,clearAudio3:null,clearAudio4:null,speedDown:null,clickAudio:null,gameOver:null,fight:null,imgBlue:null,imgPink:null,imgGreen:null,imgPurple:null,imgRed:null,imgYellow:null,imgLightBlue:null,imgGameOver:null,imgGameIntroduction:null,drawCanvasBlockFlag:!0,showGameOverFlag:!1,point:0,hasRows:0,level:1,speedTime:1e3,activeBlock:null,time:null,useTimeFlag:null,starFlag:!1,toTopFlag:!0,shapeArr:["S","Z","L","J","I","O","T"],dirArr:["up","right","down","left"],blockData:null,cacheBlock:null,cacheBlockData:{S:{up:{xy:[{x:0,y:2},{x:1,y:1},{x:1,y:2},{x:2,y:1}],dir:"up",nextDir:"right",shape:"S",color:"purple",value:1},right:{xy:[{x:1,y:0},{x:1,y:1},{x:2,y:1},{x:2,y:2}],dir:"right",nextDir:"down",shape:"S",color:"purple",value:1},down:{xy:[{x:0,y:2},{x:1,y:1},{x:1,y:2},{x:2,y:1}],dir:"down",nextDir:"left",shape:"S",color:"purple",value:1},left:{xy:[{x:1,y:0},{x:1,y:1},{x:2,y:1},{x:2,y:2}],dir:"left",nextDir:"up",shape:"S",color:"purple",value:1}},Z:{up:{xy:[{x:0,y:1},{x:1,y:1},{x:1,y:2},{x:2,y:2}],dir:"up",nextDir:"right",shape:"Z",color:"green",value:2},right:{xy:[{x:2,y:0},{x:2,y:1},{x:1,y:1},{x:1,y:2}],dir:"right",nextDir:"down",shape:"Z",color:"green",value:2},down:{xy:[{x:0,y:1},{x:1,y:1},{x:1,y:2},{x:2,y:2}],dir:"down",nextDir:"left",shape:"Z",color:"green",value:2},left:{xy:[{x:2,y:0},{x:2,y:1},{x:1,y:1},{x:1,y:2}],dir:"left",nextDir:"up",shape:"Z",color:"green",value:2}},L:{up:{xy:[{x:1,y:1},{x:1,y:2},{x:1,y:3},{x:2,y:3}],dir:"up",nextDir:"right",shape:"L",color:"blue",value:3},right:{xy:[{x:1,y:1},{x:1,y:2},{x:2,y:1},{x:3,y:1}],dir:"right",nextDir:"down",shape:"L",color:"blue",value:3},down:{xy:[{x:1,y:1},{x:2,y:1},{x:2,y:2},{x:2,y:3}],dir:"down",nextDir:"left",shape:"L",color:"blue",value:3},left:{xy:[{x:2,y:1},{x:2,y:2},{x:1,y:2},{x:0,y:2}],dir:"left",nextDir:"up",shape:"L",color:"blue",value:3}},J:{up:{xy:[{x:2,y:1},{x:2,y:2},{x:2,y:3},{x:1,y:3}],dir:"up",nextDir:"right",shape:"J",color:"pink",value:4},right:{xy:[{x:1,y:1},{x:1,y:2},{x:2,y:2},{x:3,y:2}],dir:"right",nextDir:"down",shape:"J",color:"pink",value:4},down:{xy:[{x:1,y:1},{x:1,y:2},{x:1,y:3},{x:2,y:1}],dir:"down",nextDir:"left",shape:"J",color:"pink",value:4},left:{xy:[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:2,y:2}],dir:"left",nextDir:"up",shape:"J",color:"pink",value:4}},T:{up:{xy:[{x:1,y:1},{x:1,y:2},{x:1,y:3},{x:2,y:2}],dir:"up",nextDir:"right",shape:"T",color:"lightBlue",value:5},right:{xy:[{x:0,y:1},{x:1,y:1},{x:1,y:2},{x:2,y:1}],dir:"right",nextDir:"down",shape:"T",color:"lightBlue",value:5},down:{xy:[{x:1,y:2},{x:2,y:1},{x:2,y:2},{x:2,y:3}],dir:"down",nextDir:"left",shape:"T",color:"lightBlue",value:5},left:{xy:[{x:1,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}],dir:"left",nextDir:"up",shape:"T",color:"lightBlue",value:5}},O:{up:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"up",nextDir:"right",shape:"O",color:"yellow",value:6},right:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"right",nextDir:"down",shape:"O",color:"yellow",value:6},down:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"down",nextDir:"left",shape:"O",color:"yellow",value:6},left:{xy:[{x:1,y:1},{x:2,y:1},{x:1,y:2},{x:2,y:2}],dir:"left",nextDir:"up",shape:"O",color:"yellow",value:6}},I:{up:{xy:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:1,y:3}],dir:"up",nextDir:"right",shape:"I",color:"red",value:7},right:{xy:[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1}],dir:"right",nextDir:"down",shape:"I",color:"red",value:7},down:{xy:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:1,y:3}],dir:"down",nextDir:"left",shape:"I",color:"red",value:7},left:{xy:[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1}],dir:"left",nextDir:"up",shape:"I",color:"red",value:7}}},dataArr1:[[2,2,2,2,0,0,0,0,0,0],[2,2,2,2,0,0,0,0,0,0],[2,2,2,2,0,0,0,0,0,0],[2,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],firstDataArr:[0,0,0,0,0,0,0,0,0,0],dataArr:[],deepCopy:function(e,a){var l=this,a=a||{};for(var r in e)"object"==typeof e[r]?(a[r]=e[r].constructor===Array?[]:{},l.deepCopy(e[r],a[r])):a[r]=e[r];return a},buildBlockData:function(){var e=this,a=e.rows,l=a%2==0?a/2-1:(a-1)/2;e.blockData={S:{up:{xy:[{x:l,y:0},{x:l-1,y:0},{x:l,y:-1},{x:l+1,y:-1}],dir:"up",nextDir:"right",shape:"S",color:"purple",value:1},right:{xy:[{x:l,y:-1},{x:l,y:-2},{x:l+1,y:-1},{x:l+1,y:0}],dir:"right",nextDir:"down",shape:"S",color:"purple",value:1},down:{xy:[{x:l,y:0},{x:l-1,y:0},{x:l,y:-1},{x:l+1,y:-1}],dir:"down",nextDir:"left",shape:"S",color:"purple",value:1},left:{xy:[{x:l,y:-1},{x:l,y:-2},{x:l+1,y:-1},{x:l+1,y:0}],dir:"left",nextDir:"up",shape:"S",color:"purple",value:1}},Z:{up:{xy:[{x:l-1,y:-1},{x:l,y:-1},{x:l,y:0},{x:l+1,y:0}],dir:"up",nextDir:"right",shape:"Z",color:"green",value:2},right:{xy:[{x:l+1,y:-2},{x:l+1,y:-1},{x:l,y:-1},{x:l,y:0}],dir:"right",nextDir:"down",shape:"Z",color:"green",value:2},down:{xy:[{x:l-1,y:-1},{x:l,y:-1},{x:l,y:0},{x:l+1,y:0}],dir:"down",nextDir:"left",shape:"Z",color:"green",value:2},left:{xy:[{x:l+1,y:-2},{x:l+1,y:-1},{x:l,y:-1},{x:l,y:0}],dir:"left",nextDir:"up",shape:"Z",color:"green",value:2}},L:{up:{xy:[{x:l,y:-2},{x:l,y:-1},{x:l,y:0},{x:l+1,y:0}],dir:"up",nextDir:"right",shape:"L",color:"blue",value:3},right:{xy:[{x:l-1,y:0},{x:l-1,y:-1},{x:l,y:-1},{x:l+1,y:-1}],dir:"right",nextDir:"down",shape:"L",color:"blue",value:3},down:{xy:[{x:l,y:-2},{x:l+1,y:-2},{x:l+1,y:-1},{x:l+1,y:0}],dir:"down",nextDir:"left",shape:"L",color:"blue",value:3},left:{xy:[{x:l-1,y:0},{x:l,y:0},{x:l+1,y:-1},{x:l+1,y:0}],dir:"left",nextDir:"up",shape:"L",color:"blue",value:3}},J:{up:{xy:[{x:l+1,y:-2},{x:l+1,y:-1},{x:l+1,y:0},{x:l,y:0}],dir:"up",nextDir:"right",shape:"J",color:"pink",value:4},right:{xy:[{x:l,y:-1},{x:l,y:0},{x:l+1,y:0},{x:l+2,y:0}],dir:"right",nextDir:"down",shape:"J",color:"pink",value:4},down:{xy:[{x:l,y:-2},{x:l+1,y:-2},{x:l,y:-1},{x:l,y:0}],dir:"down",nextDir:"left",shape:"J",color:"pink",value:4},left:{xy:[{x:l-1,y:-1},{x:l,y:-1},{x:l+1,y:-1},{x:l+1,y:0}],dir:"left",nextDir:"up",shape:"J",color:"pink",value:4}},T:{up:{xy:[{x:l,y:-2},{x:l,y:-1},{x:l,y:0},{x:l+1,y:-1}],dir:"up",nextDir:"right",shape:"T",color:"lightBlue",value:5},right:{xy:[{x:l-1,y:-1},{x:l,y:-1},{x:l+1,y:-1},{x:l,y:0}],dir:"right",nextDir:"down",shape:"T",color:"lightBlue",value:5},down:{xy:[{x:l+1,y:-2},{x:l+1,y:-1},{x:l,y:-1},{x:l+1,y:0}],dir:"down",nextDir:"left",shape:"T",color:"lightBlue",value:5},left:{xy:[{x:l,y:-1},{x:l,y:0},{x:l-1,y:0},{x:l+1,y:0}],dir:"left",nextDir:"up",shape:"T",color:"lightBlue",value:5}},O:{up:{xy:[{x:l,y:-1},{x:l,y:0},{x:l+1,y:-1},{x:l+1,y:0}],dir:"up",nextDir:"right",shape:"O",color:"yellow",value:6},right:{xy:[{x:l,y:-1},{x:l,y:0},{x:l+1,y:-1},{x:l+1,y:0}],dir:"right",nextDir:"down",shape:"O",color:"yellow",value:6},down:{xy:[{x:l,y:-1},{x:l,y:0},{x:l+1,y:-1},{x:l+1,y:0}],dir:"down",nextDir:"left",shape:"O",color:"yellow",value:6},left:{xy:[{x:l,y:-1},{x:l,y:0},{x:l+1,y:-1},{x:l+1,y:0}],dir:"left",nextDir:"up",shape:"O",color:"yellow",value:6}},I:{up:{xy:[{x:l,y:-3},{x:l,y:-2},{x:l,y:-1},{x:l,y:0}],dir:"up",nextDir:"right",shape:"I",color:"red",value:7},right:{xy:[{x:l-1,y:0},{x:l,y:0},{x:l+1,y:0},{x:l+2,y:0}],dir:"right",nextDir:"down",shape:"I",color:"red",value:7},down:{xy:[{x:l,y:-3},{x:l,y:-2},{x:l,y:-1},{x:l,y:0}],dir:"down",nextDir:"left",shape:"I",color:"red",value:7},left:{xy:[{x:l-1,y:0},{x:l,y:0},{x:l+1,y:0},{x:l+2,y:0}],dir:"left",nextDir:"up",shape:"I",color:"red",value:7}}}},buildDataArr:function(){for(var e=this,a=new Array,l=0;l<e.cols;l++){for(var r=new Array,i=0;i<e.rows;i++)r[i]=0;a.push(r)}e.dataArr=a},drawCacheBlock:function(){function e(){for(var e=0,i=r.xy.length;e<i;e++){var o=r.xy[e].x*a.blockSize,t=r.xy[e].y*a.blockSize;a.infoCanvas.ctx.fillStyle="rgba(0,0,0,0.3)",a.infoCanvas.ctx.fillRect(o,t,a.blockSize,a.blockSize),a.infoCanvas.ctx.drawImage(l,o,t,a.blockSize,a.blockSize)}}var a=this;a.infoCanvas.ctx.clearRect(0,0,4*a.blockSize,4*a.blockSize),a.infoCanvas.ctx.fillStyle="#295159",a.infoCanvas.ctx.fillRect(0,0,4*a.blockSize,4*a.blockSize),a.infoCanvas.ctx.stroke();var l,r=a.cacheBlockData[a.cacheBlock.shape][a.cacheBlock.dir];switch(r.color){case"blue":l=a.imgBlue;break;case"pink":l=a.imgPink;break;case"red":l=a.imgRed;break;case"green":l=a.imgGreen;break;case"purple":l=a.imgPurple;break;case"yellow":l=a.imgYellow;break;case"lightBlue":l=a.imgLightBlue}null===a.activeBlock?l.onload=function(){e()}:e()},buildRandBlock:function(){var e=this,a=Math.floor(7*Math.random()),l=Math.floor(4*Math.random()),r=e.shapeArr[a],i=e.dirArr[l];return e.deepCopy(e.blockData[r][i])},builBlockXY:function(){var e=this;null===e.cacheBlock?e.cacheBlock=e.buildRandBlock():(e.activeBlock=e.deepCopy(e.cacheBlock),e.cacheBlock=e.buildRandBlock()),e.drawCacheBlock()},updateDataArr:function(){for(var e=this,a=0,l=0,r=e.activeBlock.xy,i=e.activeBlock.value,o=0,t=r.length;o<t;o++){var n=r[o].y,c=r[o].x;e.dataArr[n]&&(e.dataArr[n][c]=i)}for(var s=0,x=r.length;s<x;s++)r[s].y>=0&&e.dataArr[r[s].y].join().indexOf("0")<0&&(e.dataArr.splice(r[s].y,1),e.dataArr.unshift([0,0,0,0,0,0,0,0,0,0]),a++);if(a>0){switch(a){case 1:l=40*e.level,e.starVoiceFlag&&(e.clearAudio1.currentTime=0,e.clearAudio1.play());break;case 2:l=100*e.level,e.starVoiceFlag&&(e.clearAudio2.currentTime=0,e.clearAudio2.play());break;case 3:l=300*e.level,e.starVoiceFlag&&(e.clearAudio3.currentTime=0,e.clearAudio3.play());break;case 4:l=1200*e.level,e.starVoiceFlag&&(e.clearAudio4.currentTime=0,e.clearAudio4.play())}e.point+=l,document.getElementById("point").innerHTML=e.point,e.hasRows+=a;var d=Math.ceil(e.hasRows/30);e.hasRows>30&&e.level<d&&(e.level=d,document.getElementById("level").innerHTML="等级 "+e.level,clearInterval(e.time),e.speedTime=e.speedTime/e.level,e.loopDown())}},changeBlockXY:function(){for(var e=this,a=!0,l=e.activeBlock.xy,r=0,i=l.length;r<i;r++){if(l[r].y+1>=e.cols){e.speedDownFlag&&e.starVoiceFlag&&(e.speedDown.currentTime=0,e.speedDown.play()),e.updateDataArr(),e.builBlockXY(),a=!1;break}var o=l[r].y+1,t=l[r].x;if(e.dataArr[o]&&e.dataArr[o][t]>=1){e.speedDownFlag&&e.starVoiceFlag&&(e.speedDown.currentTime=0,e.speedDown.play()),e.updateDataArr(),e.builBlockXY();for(var n=0,c=e.activeBlock.xy.length;n<c;n++){if(e.activeBlock.xy[n].y>=0&&e.dataArr[0][e.activeBlock.xy[n].x]>=1){e.drawCanvasBlockFlag=!1,e.toTopFlag=!1,e.showGameOverFlag=!0,console.log("游戏结束"),e.starVoiceFlag&&(e.gameOver.currentTime=0,e.gameOver.play());break}e.showGameOverFlag=!1}a=!1;break}}a&&(l[0].y+=1,l[1].y+=1,l[2].y+=1,l[3].y+=1)},drawSmBlockCanvas:function(e,a,l,r,i){var o=this;o.canvas.ctx.fillStyle="rgba(0,0,0,0.3)",o.canvas.ctx.fillRect(e,a,l,r);var t;switch(i){case"blue":t=o.imgBlue;break;case"pink":t=o.imgPink;break;case"red":t=o.imgRed;break;case"green":t=o.imgGreen;break;case"purple":t=o.imgPurple;break;case"yellow":t=o.imgYellow;break;case"lightBlue":t=o.imgLightBlue}o.canvas.ctx.drawImage(t,e,a,this.blockSize,this.blockSize)},drawBlockCanvas:function(){for(var e=this,a=e.activeBlock.xy,l=0,r=a.length;l<r;l++){var i=a[l].x*e.blockSize,o=a[l].y*e.blockSize;e.drawSmBlockCanvas(i,o,e.blockSize,e.blockSize,e.activeBlock.color)}},changeLeftRightBlockXY:function(e){var a=this,l=a.activeBlock.xy;if("right"===e){for(var r=!0,i=0,o=l.length;i<o;i++)a.dataArr[l[i].y]&&a.dataArr[l[i].y][l[i].x+1]>=1&&(r=!1),l[i].x+1>a.rows-1&&(r=!1);if(r){a.clearCanvas(),a.drawBase();for(var i=0,o=l.length;i<o;i++){l[i].x+=1;var t=l[i].x*a.blockSize,n=l[i].y*a.blockSize;a.drawSmBlockCanvas(t,n,a.blockSize,a.blockSize,a.activeBlock.color)}a.drawDataArrCanvas()}}else if("left"===e){for(var c=!0,i=0,o=l.length;i<o;i++)a.dataArr[l[i].y]&&a.dataArr[l[i].y][l[i].x-1]>=1&&(c=!1),l[i].x-1<0&&(c=!1);if(c){a.clearCanvas(),a.drawBase();for(var i=0,o=l.length;i<o;i++){l[i].x-=1;var t=l[i].x*a.blockSize,n=l[i].y*a.blockSize;a.drawSmBlockCanvas(t,n,a.blockSize,a.blockSize,a.activeBlock.color)}a.drawDataArrCanvas()}}},rotate:function(){var e=this;if("O"!==e.activeBlock.shape){for(var a=!0,l=e.activeBlock,r=l.xy,i=e.blockData[l.shape][l.dir].xy,o=r[0].y-i[0].y,t=r[0].x-i[0].x,n=e.deepCopy(e.blockData[l.shape][l.nextDir]),c=n.xy,s=0,x=c.length;s<x;s++){c[s].x+=t,c[s].y+=o;var d=c[s].y,y=c[s].x;if(y>=e.rows||y<0||e.dataArr[d]&&e.dataArr[d][y]>=1){a=!1;break}}a&&(e.activeBlock=n,e.clearCanvas(),e.drawBase(),e.drawDataArrCanvas(),e.drawCanvasBlockFlag&&e.drawBlockCanvas())}},buildUseTime:function(){var e=this,a=0,l=0,r=0,i="00",o="00",t="00";e.useTimeFlag=setInterval(function(){e.toTopFlag&&e.starFlag&&(r<59?t=++r<10?"0"+r:r:(t=(r=0)<10?"0"+r:r,l<59?o=++l<10?"0"+l:l:(o=(l=0)<10?"0"+l:l,i=++a<10?"0"+a:a)),document.getElementById("useTime").innerHTML=i+":"+o+":"+t)},1e3)},bindEvent:function(){function e(){/stopVoice/.test(r.src)&&(l.moveAudio.currentTime=0,l.moveAudio.play())}function a(){l.clickAudio.currentTime=0,l.clickAudio.play()}var l=this,r=(document.getElementById("moveVoice"),document.getElementById("startVoice"));document.addEventListener("keydown",function(a){"38"!=a.keyCode&&"87"!=a.keyCode||l.starFlag&&l.toTopFlag&&(e(),l.rotate()),"40"!=a.keyCode&&"83"!=a.keyCode||l.starFlag&&l.toTopFlag&&(l.speedDownFlag=!0,e(),l.clearCanvas(),l.drawBase(),l.changeBlockXY(),l.drawDataArrCanvas(),l.drawCanvasBlockFlag&&l.drawBlockCanvas(),l.showGameOver()),"37"!=a.keyCode&&"65"!=a.keyCode||l.starFlag&&l.toTopFlag&&(e(),l.changeLeftRightBlockXY("left")),"39"!=a.keyCode&&"68"!=a.keyCode||l.starFlag&&l.toTopFlag&&(e(),l.changeLeftRightBlockXY("right")),"32"==a.keyCode&&(e(),console.log("瞬间坠落"))}),document.addEventListener("keyup",function(e){"40"!=e.keyCode&&"83"!=e.keyCode||l.starFlag&&l.toTopFlag&&(l.speedDownFlag=!1)}),document.getElementById("startGame").addEventListener("click",function(){if(a(),/startGame/.test(this.src)){if(l.starVoiceFlag&&(l.fight.currentTime=0,l.fight.play()),null===l.activeBlock){l.bgAudio.play();var e=0,r=setInterval(function(){l.clearCanvas(),l.drawBase(),l.canvas.ctx.drawImage(l.imgGameIntroduction,0,e,l.canvasW,l.canvasH),(e+=5)===l.canvasH+5&&clearInterval(r)},5)}!0===l.toTopFlag&&(l.starFlag=!0,this.src="./images/stopGame.png",null===l.activeBlock&&(l.activeBlock=l.deepCopy(l.cacheBlock),l.cacheBlock=l.buildRandBlock(),l.drawCacheBlock())),l.useTimeFlag||l.buildUseTime(),l.time||l.loopDown()}else!0===l.toTopFlag&&(l.starFlag=!1,this.src="./images/startGame.png")}),document.getElementById("reStart").addEventListener("click",function(){l.starVoiceFlag&&(l.fight.currentTime=0,l.fight.play()),a();var e=document.getElementById("startGame");if(/startGame/.test(e.src)){if(null===l.activeBlock)return!1;e.src="./images/stopGame.png"}l.useTimeFlag&&(clearInterval(l.useTimeFlag),document.getElementById("useTime").innerHTML="00:00:00",l.buildUseTime()),l.point=0,document.getElementById("point").innerHTML=l.point,l.hasRows=0,l.level=1,document.getElementById("level").innerHTML="等级 "+l.level,l.drawCanvasBlockFlag=!0,l.starFlag=!0,l.toTopFlag=!0,l.showGameOverFlag=!1,l.speedTime=1e3,l.time&&(clearTimeout(l.time),l.clearCanvas(),l.drawBase(),l.builBlockXY(),l.buildDataArr(),l.loopDown())}),document.getElementById("startVoice").addEventListener("click",function(){a(),/stopVoice/.test(this.src)?(this.src="./images/startVoice.png",l.bgAudio.pause(),l.starVoiceFlag=!1):(this.src="./images/stopVoice.png",l.bgAudio.play(),l.starVoiceFlag=!0)})},drawDataArrCanvas:function(){for(var e=this,a=0,l=e.dataArr.length;a<l;a++)for(var r=e.dataArr[a],i=0,o=r.length;i<o;i++)if(r[i]>=1){var t="";switch(r[i]){case 1:t="purple";break;case 2:t="green";break;case 3:t="blue";break;case 4:t="pink";break;case 5:t="lightBlue";break;case 6:t="yellow";break;case 7:t="red"}var n=i*e.blockSize,c=a*e.blockSize;e.drawSmBlockCanvas(n,c,e.blockSize,e.blockSize,t)}},clearCanvas:function(){this.canvas.ctx.clearRect(0,0,this.canvasW,this.canvasH)},buildBase:function(){function e(e){var a=new Audio;return a.src="./voice/"+e+".mp3",a.preload=!0,a}function a(e,a){var l=document.createElement("img"),i=a||e;l.src="./images/"+i+".png",l.id=e,r.appendChild(l)}var l=this;l.canvasW=l.blockSize*l.rows,l.canvasH=l.blockSize*l.cols,l.canvas=document.createElement("canvas"),l.canvas.width=l.canvasW,l.canvas.height=l.canvasH,l.terisNode.appendChild(l.canvas),l.infoCanvas=document.createElement("canvas"),l.infoCanvas.width=4*l.blockSize,l.infoCanvas.height=4*l.blockSize;var r=document.createElement("div");r.id="divInfo",r.appendChild(l.infoCanvas),l.terisNode.appendChild(r);var i=document.createElement("div");i.id="useTime",i.appendChild(document.createTextNode("00:00:00")),r.appendChild(i);var o=document.createElement("div");o.id="level",o.appendChild(document.createTextNode("等级 1")),r.appendChild(o);var t=document.createElement("div"),n=document.createElement("div");t.id="pointTitle",n.id="point",t.appendChild(document.createTextNode("得分")),n.appendChild(document.createTextNode("0")),t.appendChild(n),r.appendChild(t),l.moveAudio=e("pop"),l.clearAudio1=e("good"),l.clearAudio2=e("great"),l.clearAudio3=e("excellent"),l.clearAudio4=e("amazing"),l.speedDown=e("clearBg"),l.clickAudio=e("click"),l.fight=e("fight"),l.gameOver=e("gameOver"),l.bgAudio=e("bgMusic"),l.bgAudio.loop=!0,l.bgAudio.volume=.8,a("startGame"),a("reStart"),a("startVoice","stopVoice"),l.infoCanvas.ctx=l.infoCanvas.getContext("2d"),l.infoCanvas.ctx.beginPath(),l.infoCanvas.ctx.fillStyle="#295159",l.infoCanvas.ctx.fillRect(0,0,4*l.blockSize,4*l.blockSize);for(c=1;c<4;c++)l.infoCanvas.ctx.moveTo(l.blockSize*c,0),l.infoCanvas.ctx.lineTo(l.blockSize*c,4*l.blockSize),l.infoCanvas.ctx.lineWidth=1;for(c=1;c<4;c++)l.infoCanvas.ctx.moveTo(0,l.blockSize*c),l.infoCanvas.ctx.lineTo(4*l.blockSize,l.blockSize*c),l.infoCanvas.ctx.lineWidth=1;l.infoCanvas.ctx.strokeStyle="#B8895F",l.infoCanvas.ctx.stroke(),l.canvas.ctx=l.canvas.getContext("2d"),l.canvas.ctx.beginPath();for(c=1;c<l.rows;c++)l.canvas.ctx.moveTo(l.blockSize*c,0),l.canvas.ctx.lineTo(l.blockSize*c,l.canvasH),l.canvas.ctx.lineWidth=1;for(var c=1;c<l.cols;c++)l.canvas.ctx.moveTo(0,l.blockSize*c),l.canvas.ctx.lineTo(l.canvasW,l.blockSize*c),l.canvas.ctx.lineWidth=1;l.canvas.ctx.strokeStyle="#B8895F",l.drawBase()},drawBase:function(){this.canvas.ctx.stroke()},showGameOver:function(){var e=this,a=e.canvasH;if(e.showGameOverFlag){e.canvas.ctx.fillStyle="rgba(0,0,0,0.3)";var l=setInterval(function(){e.clearCanvas(),e.drawBase(),e.drawDataArrCanvas(),e.canvas.ctx.fillRect(0,a,e.canvasW,e.canvasH),-10===(a-=10)&&(clearInterval(l),e.canvas.ctx.drawImage(e.imgGameOver,25,125,200,128))},10)}},drawIntroduction:function(){var e=this;e.imgGameIntroduction.onload=function(){console.log(this.width),e.canvas.ctx.drawImage(e.imgGameIntroduction,0,0,this.width,this.height)}},loopDown:function(){var e=this;e.time=setInterval(function(){e.starFlag&&e.toTopFlag&&(e.clearCanvas(),e.drawBase(),e.drawCanvasBlockFlag&&e.drawBlockCanvas(),e.changeBlockXY(),e.drawDataArrCanvas(),e.showGameOver()),console.log(e.time)},e.speedTime)},preImg:function(){var e=this;e.imgBlue=new Image,e.imgBlue.src="./images/blueBlcok.png",e.imgPink=new Image,e.imgPink.src="./images/pinkBlcok.png",e.imgGreen=new Image,e.imgGreen.src="./images/greenBlcok.png",e.imgRed=new Image,e.imgRed.src="./images/RedBlcok.png",e.imgPurple=new Image,e.imgPurple.src="./images/purpleBlcok.png",e.imgYellow=new Image,e.imgYellow.src="./images/yellowBlcok.png",e.imgLightBlue=new Image,e.imgLightBlue.src="./images/lightBlueBlcok.png",e.imgGameOver=new Image,e.imgGameOver.src="./images/gameOver.png",e.imgGameIntroduction=new Image,e.imgGameIntroduction.src="./images/gameIntroduction.jpg"},_init:function(){var e=this;e.preImg(),e.buildBlockData(),e.buildDataArr(),e.buildBase(),e.builBlockXY(),e.bindEvent(),e.drawIntroduction()}},window.Tetris=e}();